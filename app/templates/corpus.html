{% extends 'base.html' %}
{% block navbar %}
<li class="active"><a href="/main">Home</a></li>
{% endblock%}
{% block content %}

<main style="margin-top: 200px;" id="main">

    <!-- ======= Breadcrumbs ======= -->
    <section class="breadcrumbs">
      <div class="container">

        <div class="d-flex justify-content-between align-items-center">
          <h2>Frequent Tokens</h2>
        </div>
        <div class="faq-list">
          <button class="nice-button" onclick="location.href='/texts'">Back<i style='color:white;'class='icofont-long-arrow-left'></i></button>
          
          <button class="nice-button" onclick="location.href='/export-texts'">Next<i style='color:white;'class='icofont-long-arrow-right'></i></button>
         </div>  
         <br>
         <p>In this section you can add lemma, pos, and entity labels to frequent tokens. You will significantly reduce the amount
          of time needed to annotate your corpus. You can also mark tokens as stop words. They will have a
          token.is_stop attribute.</p>
      </div>
    </section><!-- End Breadcrumbs -->

    <!-- ======= Counts Section ======= -->
<section id="counts" class="counts">
    <div class="container">

      <div class="row counters">
        {% if stats %}
        <div class="col-lg-3 col-6 text-center">
          {% if stats.texts %}
          <span data-toggle="counter-up">{{ stats.texts }}</span>
          <p>Texts</p>
          {% endif %}
        </div>

        <div class="col-lg-3 col-6 text-center">
          {% if stats.tokens %}
          <span data-toggle="counter-up">{{ stats.tokens }}</span>
          <p>Tokens</p>
          {% endif %}
        </div>
        {% if stats.sents %}
        <div class="col-lg-3 col-6 text-center">
          <span data-toggle="counter-up">{{ stats.sents }}</span>
          <p>Sentences</p>
        </div>
        {% endif %}

        {% if stats.sents %}
        <div class="col-lg-3 col-6 text-center">
          <span data-toggle="counter-up">{{ stats.ents }}</span>
          <p>Entities</p>
        </div>
        {% endif %}
        
        {% endif %}
      </div>
    </div>
  </section><!-- End Counts Section -->
  <section id="testimonials" class="testimonials section-bg">
    <div class="container">
      <table id="tokens" class="display" style="width:100%"></table>
      </div>
  </section>





{% endblock %}

{% block extrajs %}
<script src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.23/js/dataTables.bootstrap4.min.js"></script>

<script>
    $('#header').addClass('header-scrolled')
    let tokens = {{ tokens_json|safe }};
    let data = []; 
    for (const token of tokens) {
      data.push(new Array(token.count, token.text, token.lemma_,token.pos_,token.is_stop));
    }
    $('#tokens').DataTable( {
      data: data,
      pageLength: 50,
      order: [[ 0, "desc" ]],
      columns: [
            { title: "Count" },
            //{ title: "Before" },
            { title: "Text" },
            //{ title: "After" },
            { title: "Lemma" },
            { title: "Part of Speech" },
            { title: "Stop Word",
            "render": function ( row, type, val, meta ) {
              return "<p onclick='edit_stop(this,"+ '"'+ val[1]+ '"' + ");'>" +row +"</p>"; }
            }
        ]
  } );
</script>
<script>
  function edit_stop(e, val) { 

    if (e.innerHTML == '☐'){
      e.innerHTML="☑";
      $.get( "add_stopword?word="+val, function( data ) {
        // success
      });
     
    }
    else {
      e.innerHTML = "☐";
      $.get( "delete_stopword?word="+val, function( data ) {
        // success
      });
    }
    
  };
</script>

{% endblock %}

<!-- TODO 
add filters to exclude common stop word-type tokens 
ability to mark token as a stop word and update stop words.py
ability to click on cell in dataframe and update values, save those in lookups -->